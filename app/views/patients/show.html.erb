<ul class="breadcrumb">
  <%= render "layouts/breadcrumbs/home" %>
  <%= render "layouts/breadcrumbs/district" %>
  <%= render "layouts/breadcrumbs/facility" %>
</ul>

<%= link_to "Edit Patient", edit_district_facility_patient_path(@district, @facility, @patient), class: "btn btn-secondary float-right" %>

<h1>
  Treatment Number <%= @patient.formatted_treatment_number %>
</h1>

<div class="row my-5">
  <div class="col-md-6">
    <h3>A. Patient Identification Information</h3>
    <ul class="list-group">
      <li class="list-group-item"><strong>Date of Registration</strong>: <%= @patient.registered_on %></li>
      <li class="list-group-item"><strong>Name</strong>: <%= @patient.name %></li>
      <li class="list-group-item"><strong>Gender</strong>: <%= @patient.gender %></li>
      <li class="list-group-item"><strong>Age</strong>: <%= @patient.age %></li>
      <li class="list-group-item"><strong>House number</strong>: <%= @patient.house_number %></li>
      <li class="list-group-item"><strong>Street name</strong>: <%= @patient.street_name %></li>
      <li class="list-group-item"><strong>Area/Colony</strong>: <%= @patient.area %></li>
      <li class="list-group-item"><strong>Village/Town</strong>: <%= @patient.village %></li>
      <li class="list-group-item"><strong>District</strong>: <%= @patient.district %></li>
      <li class="list-group-item"><strong>Pincode</strong>: <%= @patient.pincode %></li>
      <li class="list-group-item"><strong>Patient phone</strong>: <%= @patient.phone %></li>
      <li class="list-group-item"><strong>Alternate phone</strong>: <%= @patient.alternate_phone %></li>
    </ul>
  </div>
  <div class="col-md-6">
    <h3>B. Diagnosis</h3>
    <ul class="list-group">
      <li class="list-group-item"><strong>Hypertension. Yes, treatment initiated:</strong>
        <span><%= display_yes_no_field(@patient.diagnosed_with_hypertension) %></span>
      </li>
      <li class="list-group-item"><strong>Yes, was already on treatment when registered:</strong>
        <span><%= display_yes_no_field(@patient.already_on_treatment) %></span>
      </li>
      <li class="list-group-item"><strong>Prior heart attack?</strong>
        <span><%= display_yes_no_field(@patient.prior_heart_attack) %></span>
      </li>
      <li class="list-group-item"><strong>Heart attack in last 3 years?</strong>
        <span><%= display_yes_no_field(@patient.heart_attack_in_last_3_years) %></span>
      </li>
      <li class="list-group-item"><strong>Prior stroke?</strong>
        <span><%= display_yes_no_field(@patient.prior_stroke) %></span>
      </li>
      <li class="list-group-item"><strong>Chronic kidney disease?</strong>
        <span><%= display_yes_no_field(@patient.chronic_kidney_disease) %></span>
      </li>
    </ul>

    <h3 class="mt-4">C. Hypertension treatment at registration</h3>
    <ul class="list-group">
      <li class="list-group-item"><strong>Medication 1</strong>: <%= [@patient.medication1_name, @patient.medication1_dose].join(" ") %></li>
      <li class="list-group-item"><strong>Medication 2</strong>: <%= [@patient.medication2_name, @patient.medication2_dose].join(" ") %></li>
      <li class="list-group-item"><strong>Medication 3</strong>: <%= [@patient.medication3_name, @patient.medication3_dose].join(" ") %></li>
      <li class="list-group-item"><strong>Medication 4</strong>: <%= [@patient.medication4_name, @patient.medication4_dose].join(" ") %></li>
    </ul>
  </div>
</div>

<%= link_to "Add Visit Details", new_district_facility_patient_visit_path(@district, @facility, @patient), class: "btn btn-primary" %>

<h4>Visits</h4>
<div class="row mb-5">
  <% @patient.visits.order(:measured_on).each do |visit| %>
    <div class="col-md-2">
      <dl>
        <dt class="border-top pt-2">Date Attended</dt>
        <dd><%= visit.measured_on %></dd>

        <dt class="border-top pt-2">Systolic</dt>
        <dd><%= visit.systolic || '<span class="text-muted">none</span>'.html_safe %></dd>

        <dt class="border-top pt-2">Diastolic</dt>
        <dd><%= visit.diastolic.present? ? visit.diastolic : '<span class="text-muted">none</span>'.html_safe %></dd>

        <dt class="border-top pt-2">Blood Sugar</dt>
        <dd><%= visit.blood_sugar.present? ? visit.blood_sugar : '<span class="text-muted">none</span>'.html_safe %></dd>

        <% %i(amlodipine telmisartan enalpril chlorthalidone aspirin statin beta_blocker).each do |drug| %>
          <dt class="border-top pt-2"><%= drug.to_s.humanize %></dt>
          <dd><%= visit.send(drug).present? ? visit.send(drug).to_s : '<span class="text-muted">none</span>'.html_safe %></dd>
        <% end %>

        <% (1..3).each do |drug_number| %>
          <dt class="border-top pt-2">Medication <%= drug_number %></dt>
          <% if visit.send("medication#{drug_number}_name".to_sym).present? %>
            <dd><%= visit.send("medication#{drug_number}_name".to_sym).to_s %>: <%= visit.send("medication#{drug_number}_dose".to_sym) %></dd>
          <% else %>
            <dd><span class="text-muted">none</span></dd>
          <% end %>
        <% end %>

        <dt class="border-top pt-2">Referred to Specialist</dt>
        <dd><%= visit.referred_to_specialist? ? "Yes" : "No" %></dd>

        <dt class="border-top pt-2">Date of Next Visit</dt>
        <dd><%= visit.next_visit_on.present? ? visit.next_visit_on : '<span class="text-muted">none</span>'.html_safe %></dd>
      </dl>

      <%= link_to "Edit", edit_district_facility_patient_visit_path(@district, @facility, @patient, visit), class: "btn btn-sm btn-secondary my-0" %>
    </div>
  <% end %>
</div>

<%= link_to "Delete Patient", district_facility_patient_path(@district, @facility, @patient), method: :delete, class: "btn btn-sm btn-outline-danger float-right", data: { confirm: "Are you sure you want to delete this patient?" } %>

<%= link_to "Save and Add New Treatment Card", new_district_facility_patient_path(@district, @facility, @patient), class: "btn btn-primary" %><br>

